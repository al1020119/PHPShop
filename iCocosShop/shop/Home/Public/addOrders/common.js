function addToCart(c,j){var b=new Object();var a=new Array();var g=new Array();var d=1;var h=document.forms.ECS_FORMBUY;var f=0;if(h){a=getSelectedAttributes(h);if(h.elements.number){d=h.elements.number.value}f=1}b.quick=f;b.spec=a;b.goods_id=c;b.number=d;b.parent=(typeof(j)=="undefined")?0:parseInt(j);Ajax.call("flow.php?step=add_to_cart","goods="+$.toJSON(b),addToCartResponse,"POST","JSON")}function check_stock_for_pay(a){Ajax.call("flow.php?step=check_stock","order_id="+a,check_stock_for_pay_response,"POST","JSON",false)}function check_stock_for_pay_response(a){if(a.error>0){alert(a.message);return false}else{document.forms.payment_form.submit()}}function check_stock_for_pay_bocom(a){Ajax.call("flow.php?step=check_stock","order_id="+a,check_stock_for_pay_bocom_response,"POST","JSON",false)}function check_stock_for_pay_bocom_response(a){if(a.error>0){alert(a.message);return false}else{if(window.ActiveXObject){document.charset="GBK"}document.forms.payment_form.submit()}}function uncheckedAllInput(){var b=document.forms.ECS_FORMBUY;for(i=0;i<b.elements.length;i++){var a=b.elements[i].name.substr(0,5);if(a=="spec_"&&(((b.elements[i].type=="radio"||b.elements[i].type=="checkbox")&&b.elements[i].checked)||b.elements[i].tagName=="SELECT")){b.elements[i].checked=false;i++}}return true}function getSelectedAttributes(k){var a=new Array();var c=0;var g={};var d={};for(i=0;i<k.elements.length;i++){var h=k.elements[i].name.substr(0,5);if(h=="spec_"&&(((k.elements[i].type=="radio"||k.elements[i].type=="checkbox")&&k.elements[i].checked)||k.elements[i].tagName=="SELECT")){a[c]=k.elements[i].value;c++}if(k.elements[i].type=="radio"){var b=k.elements[i].name;g[b]=k.elements[i].id;if(k.elements[i].checked){d[b]=k.elements[i].id}}}for(var b in g){if(typeof(g[b])=="function"){continue}if(typeof(d[b])=="undefined"){var f=document.getElementById(g[b]);alert("请选择"+f.getAttribute("spec_name"));exit}}return a}function judgeColorSelected(b){var d=document.forms.ECS_FORMBUY;var c=new Array();var g=0;var f={};var l={};for(i=0;i<d.elements.length;i++){var h=d.elements[i].name.substr(0,5);if(h=="spec_"&&(((d.elements[i].type=="radio"||d.elements[i].type=="checkbox")&&d.elements[i].checked)||d.elements[i].tagName=="SELECT")){c[g]=d.elements[i].value;g++}if(d.elements[i].type=="radio"){var a=d.elements[i].name;f[a]=d.elements[i].id;if(d.elements[i].checked){l[a]=d.elements[i].id}}}for(var a in f){if(a=="spec_"+b){continue}if(typeof(f[a])=="function"){continue}if(typeof(l[a])=="undefined"){var k=document.getElementById(f[a]);alert("请选择"+k.getAttribute("spec_name"));exit}}return c}function addToCartResponse(a){if(a.error>0){if(a.error==6){openSpeDiv(a.message,a.goods_id,a.parent,0,0,a.title)}else{if(a.error==2){if(a.type=="add_gift"){document.getElementById("gift_error").innerHTML=a.message}else{alert(a.message)}}else{if(a.error==7){if(a.type=="add_gift"){document.getElementById("gift_error").innerHTML=a.message}else{alert(a.message)}}else{if(a.type=="add_gift"){document.getElementById("gift_error").innerHTML=a.message}else{alert(a.message)}}}}}else{var c=document.getElementById("ECS_CARTINFO");var b="/flow.php?step=cart";if(c){c.innerHTML=a.content}if(a.one_step_buy=="1"){location.href=b}else{switch(a.confirm_type){case"1":if(confirm(a.message)){location.href=b}break;case"2":if(!confirm(a.message)){location.href=b}break;case"3":location.href=b;break;default:break}}}}function collect(a,b){Ajax.call("user.php?act=collect&shareToSina="+b,"id="+a,collectResponse,"GET","JSON")}function collectResponse(a){alert(a.message)}function signInResponse(a){toggleLoader(false);var b=a.substr(0,1);var c=a.substr(2);if(b==1){document.getElementById("member-zone").innerHTML=c}else{alert(c)}}function gotoPage(b,c,a){Ajax.call("comment.php?act=gotopage","page="+b+"&id="+c+"&type="+a,gotoPageResponse,"GET","JSON")}function gotoPageResponse(a){$("#ECS_COMMENT").html("");$("#ECS_COMMENT").html(a.content)}function gotoBuyPage(a,b){Ajax.call("goods.php?act=gotopage","page="+a+"&id="+b,gotoBuyPageResponse,"GET","JSON")}function gotoBuyPageResponse(a){document.getElementById("ECS_BOUGHT").innerHTML=a.result}function getFormatedPrice(a){if(currencyFormat.indexOf("%s")>-1){return currencyFormat.replace("%s",advFormatNumber(a,2))}else{if(currencyFormat.indexOf("%d")>-1){return currencyFormat.replace("%d",advFormatNumber(a,0))}else{return a}}}function bid(c){var b="";var f="";if(c!=-1){var d=document.forms.formBid;b=d.elements.price.value;id=d.elements.snatch_id.value;if(b.length==0){f+=price_not_null+"\n"}else{var a=/^[\.0-9]+/;if(!a.test(b)){f+=price_not_number+"\n"}}}else{b=c}if(f.length>0){alert(f);return}Ajax.call("snatch.php?act=bid&id="+id,"price="+b,bidResponse,"POST","JSON")}function newPrice(a){Ajax.call("snatch.php?act=new_price_list&id="+a,"",newPriceResponse,"GET","TEXT")}function newPriceResponse(a){document.getElementById("ECS_PRICE_LIST").innerHTML=a}function getAttr(d){var a=document.getElementsByTagName("tbody");for(i=0;i<a.length;i++){if(a[i].id.substr(0,10)=="goods_type"){a[i].style.display="none"}}var b="goods_type_"+d;try{document.getElementById(b).style.display=""}catch(c){}}function advFormatNumber(j,g){var f=formatNumber(j,g);var b=parseFloat(f);if(j.toString().length>f.length){var c=j.toString().substring(f.length,f.length+1);var a=parseFloat(c);if(a<5){return f}else{var k,h;if(g==0){h=1}else{k="0.";for(var d=1;d<g;d++){k+="0"}k+="1";h=parseFloat(k)}f=formatNumber(b+h,g)}}return f}function formatNumber(j,g){var f,d,k,h;f=j.toString();d=f.indexOf(".");k=f.length;if(g==0){if(d!=-1){f=f.substring(0,d)}}else{if(d==-1){f=f+".";for(h=1;h<=g;h++){f=f+"0"}}else{f=f.substring(0,d+g+1);for(h=k;h<=d+g;h++){f=f+"0"}}}return f}function set_insure_status(){var a=getRadioValue("shipping");var b=0;if(a>0){if(document.forms.theForm.elements["insure_"+a]){b=document.forms.theForm.elements["insure_"+a].value}if(document.forms.theForm.elements.need_insure){document.forms.theForm.elements.need_insure.checked=false}if(document.getElementById("ecs_insure_cell")){if(b>0){document.getElementById("ecs_insure_cell").style.display="";setValue(document.getElementById("ecs_insure_fee_cell"),getFormatedPrice(b))}else{document.getElementById("ecs_insure_cell").style.display="none";setValue(document.getElementById("ecs_insure_fee_cell"),"")}}}}function changePayment(a){calculateOrderFee()}function getCoordinate(a){var b={x:0,y:0};b.x=document.body.offsetLeft;b.y=document.body.offsetTop;do{b.x+=a.offsetLeft;b.y+=a.offsetTop;a=a.offsetParent}while(a.tagName.toUpperCase()!="BODY");return b}function showCatalog(a){var c=getCoordinate(a);var b=document.getElementById("ECS_CATALOG");if(b&&b.style.display!="block"){b.style.display="block";b.style.left=c.x+"px";b.style.top=(c.y+a.offsetHeight-1)+"px"}}function hideCatalog(a){var b=document.getElementById("ECS_CATALOG");if(b&&b.style.display!="none"){b.style.display="none"}}function sendHashMail(){Ajax.call("user.php?act=send_hash_mail","",sendHashMailResponse,"GET","JSON")}function sendHashMailResponse(a){alert(a.message)}function orderQuery(){var b=document.forms.ecsOrderQuery["order_sn"].value;var a=/^[\.0-9]+/;if(b.length<10||!a.test(b)){alert(invalid_order_sn);return}Ajax.call("user.php?act=order_query&order_sn=s"+b,"",orderQueryResponse,"GET","JSON")}function orderQueryResponse(a){if(a.message.length>0){alert(a.message)}if(a.error==0){var b=document.getElementById("ECS_ORDER_QUERY");b.innerHTML=a.content}}function display_mode(b){document.getElementById("display").value=b;setTimeout(a,0);function a(){document.forms.listform.submit()}}function display_mode_wholesale(b){document.getElementById("display").value=b;setTimeout(a,0);function a(){document.forms.wholesale_goods.action="wholesale.php";document.forms.wholesale_goods.submit()}}function fixpng(){var g=navigator.appVersion.split("MSIE");var h=parseFloat(g[1]);if((h>=5.5&&h<6)&&(document.body.filters)){for(var c=0;c<document.images.length;c++){var d=document.images[c];var k=d.src.toUpperCase();if(k.substring(k.length-3,k.length)=="PNG"){var f=(d.id)?"id='"+d.id+"' ":"";var l=(d.className)?"class='"+d.className+"' ":"";var b=(d.title)?"title='"+d.title+"' ":"title='"+d.alt+"' ";var j="display:inline-block;"+d.style.cssText;if(d.align=="left"){j="float:left;"+j}if(d.align=="right"){j="float:right;"+j}if(d.parentElement.href){j="cursor:hand;"+j}var a="<span "+f+l+b+' style="width:'+d.width+"px; height:"+d.height+"px;"+j+";filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+d.src+"', sizingMethod='scale');\"></span>";d.outerHTML=a;c=c-1}}}}function hash(b,d){var d=d?d:32;var f=0;var c=0;var a="";filllen=d-b.length%d;for(c=0;c<filllen;c++){b+="0"}while(f<b.length){a=stringxor(a,b.substr(f,d));f+=d}return a}function stringxor(f,c){var g="";var h="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";var a=Math.max(f.length,c.length);for(var d=0;d<a;d++){var b=f.charCodeAt(d)^c.charCodeAt(d);g+=h.charAt(b%52)}return g}var evalscripts=new Array();function evalscript(b){if(b.indexOf("<script")==-1){return b}var c=/<script[^\>]*?src=\"([^\>]*?)\"[^\>]*?(reload=\"1\")?(?:charset=\"([\w\-]+?)\")?><\/script>/ig;var a=new Array();while(a=c.exec(b)){appendscript(a[1],"",a[2],a[3])}return b}function $$(a){return document.getElementById(a)}function appendscript(f,d,b,h){var g=hash(f+d);if(!b&&in_array(g,evalscripts)){return}if(b&&$$(g)){$$(g).parentNode.removeChild($$(g))}evalscripts.push(g);var a=document.createElement("script");a.type="text/javascript";a.id=g;try{if(f){a.src=f}else{if(d){a.text=d}}$$("append_parent").appendChild(a)}catch(c){}}function in_array(c,b){if(typeof c=="string"||typeof c=="number"){for(var a in b){if(b[a]==c){return true}}}return false}var pmwinposition=new Array();var userAgent=navigator.userAgent.toLowerCase();var is_opera=userAgent.indexOf("opera")!=-1&&opera.version();var is_moz=(navigator.product=="Gecko")&&userAgent.substr(userAgent.indexOf("firefox")+8,3);var is_ie=(userAgent.indexOf("msie")!=-1&&!is_opera)&&userAgent.substr(userAgent.indexOf("msie")+5,3);function pmwin(d,j){var h=document.getElementsByTagName("OBJECT");if(d=="open"){for(i=0;i<h.length;i++){if(h[i].style.visibility!="hidden"){h[i].setAttribute("oldvisibility",h[i].style.visibility);h[i].style.visibility="hidden"}}var g=document.body.clientWidth;var b=document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight;var f=document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop;var c=800;var a=b*0.9;if(!$$("pmlayer")){div=document.createElement("div");div.id="pmlayer";div.style.width=c+"px";div.style.height=a+"px";div.style.left=((g-c)/2)+"px";div.style.position="absolute";div.style.zIndex="999";$$("append_parent").appendChild(div);$$("pmlayer").innerHTML='<div style="width: 800px; background: #666666; margin: 5px auto; text-align: left"><div style="width: 800px; height: '+a+'px; padding: 1px; background: #FFFFFF; border: 1px solid #7597B8; position: relative; left: -6px; top: -3px"><div onmousedown="pmwindrag(event, 1)" onmousemove="pmwindrag(event, 2)" onmouseup="pmwindrag(event, 3)" style="cursor: move; position: relative; left: 0px; top: 0px; width: 800px; height: 30px; margin-bottom: -30px;"></div><a href="###" onclick="pmwin(\'close\')"><img style="position: absolute; right: 20px; top: 15px" src="images/close.gif" title="关闭" /></a><iframe id="pmframe" name="pmframe" style="width:'+c+'px;height:100%" allowTransparency="true" frameborder="0"></iframe></div></div>'}$$("pmlayer").style.display="";$$("pmlayer").style.top=((b-a)/2+f)+"px";if(!j){pmframe.location="pm.php"}else{pmframe.location="pm.php?"+j}}else{if(d=="close"){for(i=0;i<h.length;i++){if(h[i].attributes.oldvisibility){h[i].style.visibility=h[i].attributes.oldvisibility.nodeValue;h[i].removeAttribute("oldvisibility")}}hiddenobj=new Array();$$("pmlayer").style.display="none"}}}var pmwindragstart=new Array();function pmwindrag(b,c){if(c==1){pmwindragstart=is_ie?[event.clientX,event.clientY]:[b.clientX,b.clientY];pmwindragstart[2]=parseInt($$("pmlayer").style.left);pmwindragstart[3]=parseInt($$("pmlayer").style.top);doane(b)}else{if(c==2&&pmwindragstart[0]){var a=is_ie?[event.clientX,event.clientY]:[b.clientX,b.clientY];$$("pmlayer").style.left=(pmwindragstart[2]+a[0]-pmwindragstart[0])+"px";$$("pmlayer").style.top=(pmwindragstart[3]+a[1]-pmwindragstart[1])+"px";doane(b)}else{if(c==3){pmwindragstart=[];doane(b)}}}}function doane(a){e=a?a:window.event;if(is_ie){e.returnValue=false;e.cancelBubble=true}else{if(e){e.stopPropagation();e.preventDefault()}}}function addPackageToCart(c){var b=new Object();var a=1;b.package_id=c;b.number=a;Ajax.call("flow.php?step=add_package_to_cart","package_info="+$.toJSON(b),addPackageToCartResponse,"POST","JSON")}function addPackageToCartResponse(a){if(a.error>0){if(a.error==2){if(confirm(a.message)){location.href="user.php?act=add_booking&id="+a.goods_id}}else{alert(a.message)}}else{var c=document.getElementById("ECS_CARTINFO");var b="flow.php?step=cart";if(c){c.innerHTML=a.content}if(a.one_step_buy=="1"){location.href=b}else{switch(a.confirm_type){case"1":if(confirm(a.message)){location.href=b}break;case"2":if(!confirm(a.message)){location.href=b}break;case"3":location.href=b;break;default:break}}}}function setSuitShow(b){var a=document.getElementById("suit_"+b);if(a==null){return}if(a.style.display=="none"){a.style.display=""}else{a.style.display="none"}}function docEle(){return document.getElementById(arguments[0])||false}function openSpeDiv(s,n,q,f,l,o){var p="speDiv";var d="mask";if(docEle(p)){document.removeChild(docEle(p))}if(docEle(d)){document.removeChild(docEle(d))}var c;if(typeof window.pageYOffset!="undefined"){c=window.pageYOffset}else{if(typeof document.compatMode!="undefined"&&document.compatMode!="BackCompat"){c=document.documentElement.scrollTop}else{if(typeof document.body!="undefined"){c=document.body.scrollTop}}}var h=0;var j=document.getElementsByTagName("select");while(j[h]){j[h].style.visibility="hidden";h++}var a=document.createElement("div");a.id=p;a.style.position="absolute";a.style.zIndex="10000";a.style.width="300px";a.style.height="210px";a.style.top=(parseInt(c+200))+"px";a.style.left=(parseInt(document.body.offsetWidth)-200)/2+"px";a.style.overflow="auto";a.style.background="#FFF";a.style.padding="5px";var g="";g+="<h2>"+o+"</h2>";g+="<ul>";for(var r=0;r<s.length;r++){g+="<li>";g+="请选择"+s[r]["name"]+"：";g+='<select name="spec_'+s[r]["attr_id"]+'" onchange="clear_gift_error()">';for(var b=0;b<s[r]["values"].length;b++){g+='<option value="'+s[r]["values"][b]["id"]+'">'+s[r]["values"][b]["label"]}g+="</select>";g+="</li>"}g+='<li id="gift_error"></li>';g+='<li class="btnBar"><a href="javascript:submit_div('+n+","+q+","+f+","+l+')" class="product_addtocart_mini" >&nbsp;</a><a href="javascript:cancel_div()" class="btnCancel">取消</a></li>';g+="</ul>";a.innerHTML=g;document.body.appendChild(a);var k=document.createElement("div");k.id=d;k.style.position="absolute";k.style.zIndex="9999";k.style.width=document.body.scrollWidth+"px";k.style.height=document.body.scrollHeight+"px";k.style.top="0px";k.style.left="0px";k.style.background="#FFF";k.style.filter="alpha(opacity=30)";k.style.opacity="0.40";document.body.appendChild(k)}function clear_gift_error(){document.getElementById("gift_error").innerHTML=""}function submit_div(p,l,a,o){var k=new Object();var b=new Array();var q=new Array();var c=1;var g=document.getElementsByTagName("select");var f=1;var b=new Array();var d=0;for(h=0;h<g.length;h++){var n=g[h].name.substr(0,5);if(n=="spec_"){b[d]=g[h].value;d++}}k.quick=f;k.spec=b;k.goods_id=p;k.number=c;k.parent=(typeof(l)=="undefined")?0:parseInt(l);k.is_gift=(typeof(a)=="undefined")?0:parseInt(a);k.act_id=(typeof(o)=="undefined")?0:parseInt(o);if(k.is_gift!=0){Ajax.call("flow.php?step=add_favourable","goods="+$.toJSON(k),addToCartResponse,"POST","JSON")}else{Ajax.call("flow.php?step=add_to_cart","goods="+$.toJSON(k),addToCartResponse,"POST","JSON")}var h=0;var m=document.getElementsByTagName("select");while(m[h]){m[h].style.visibility="";h++}alert_t=0}function cancel_div(){document.body.removeChild(docEle("speDiv"));document.body.removeChild(docEle("mask"));var b=0;var a=document.getElementsByTagName("select");while(a[b]){a[b].style.visibility="";b++}};